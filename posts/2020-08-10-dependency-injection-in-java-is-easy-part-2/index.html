<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency Injection in Java is easy - Part 2 - Leveraging with Google Guice</title>
    <meta name="description" content="Learn how to leverage Google Guice as a dependency injection framework in Java.">
    <meta name="generator" content="Eleventy v2.0.0">

    <link rel="preconnect" href="https://www.redhat.com">
    <link rel="preconnect" href="https://static.redhat.com">
    <link rel="shortcut icon" href="https://www.redhat.com/misc/favicon.ico" type="image/x-icon">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Red Hat Israel">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Red Hat Israel">

    <link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2/webfonts/red-hat-font.css" media="all">
    <link rel="stylesheet" href="/assets/css/rhds.css">
    <link rel="stylesheet" href="/assets/css/index.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/prism-diff.css">
    <link rel="stylesheet" href="/assets/packages/@rhds/elements/elements/rh-footer/rh-footer-lightdom.css">
    <link rel="stylesheet" href="/assets/packages/@rhds/elements/elements/rh-navigation-secondary/rh-navigation-secondary-lightdom.css">
    <link rel="stylesheet" href="/assets/packages/@rhds/elements/elements/rh-pagination/rh-pagination-lightdom.css">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+Hebrew" rel="stylesheet">
    
    <link rel="canonical" href="https://dev.to/tomerfi/dependency-injection-in-java-is-easy-part-2-leveraging-with-google-guice-6i4" />
    
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css"></noscript>

    <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js"></script>
    <script type="importmap">{"imports":{"tslib":"https://ga.jspm.io/npm:tslib@2.5.0/tslib.es6.js","element-internals-polyfill":"https://ga.jspm.io/npm:element-internals-polyfill@1.2.6/dist/index.js","@rhds/tokens":"https://ga.jspm.io/npm:@rhds/tokens@1.0.0-beta.17/js/tokens.js","lit":"https://ga.jspm.io/npm:lit@2.6.1/index.js","@patternfly/elements/pf-spinner/BaseSpinner.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-spinner/BaseSpinner.js","@patternfly/elements/pf-spinner/pf-spinner.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-spinner/pf-spinner.js","@patternfly/elements/pf-icon/pf-icon.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-icon/pf-icon.js","@patternfly/elements/pf-button/pf-button.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-button/pf-button.js","@patternfly/elements/pf-panel/pf-panel.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-panel/pf-panel.js","@rhds/elements/rh-alert/rh-alert.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-alert/rh-alert.js","@rhds/elements/rh-tag/rh-tag.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-tag/rh-tag.js","@patternfly/elements/pf-card/pf-card.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-card/pf-card.js","@rhds/elements/rh-cta/rh-cta.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-cta/rh-cta.js","@rhds/elements/rh-stat/rh-stat.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-stat/rh-stat.js","@rhds/elements/rh-pagination/rh-pagination.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-pagination/rh-pagination.js","@patternfly/elements/pf-accordion/pf-accordion.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-accordion/pf-accordion.js","@patternfly/elements/pf-modal/pf-modal.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-modal/pf-modal.js","@rhds/elements/rh-footer/rh-footer.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-footer/rh-footer.js","@rhds/elements/rh-navigation-secondary/rh-navigation-secondary.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-navigation-secondary/rh-navigation-secondary.js","@patternfly/elements/pf-tabs/pf-tabs.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-tabs/pf-tabs.js","@patternfly/elements/pf-tooltip/pf-tooltip.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-tooltip/pf-tooltip.js","@patternfly/elements/pf-tooltip/BaseTooltip.js":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/pf-tooltip/BaseTooltip.js"},"scopes":{"https://ga.jspm.io/":{"@floating-ui/core":"https://ga.jspm.io/npm:@floating-ui/core@1.2.2/dist/floating-ui.core.browser.min.mjs","@floating-ui/dom":"https://ga.jspm.io/npm:@floating-ui/dom@1.2.3/dist/floating-ui.dom.browser.min.mjs","@lit/reactive-element":"https://ga.jspm.io/npm:@lit/reactive-element@1.6.1/reactive-element.js","@lit/reactive-element/decorators/":"https://ga.jspm.io/npm:@lit/reactive-element@1.6.1/decorators/","@patternfly/elements/":"https://ga.jspm.io/npm:@patternfly/elements@2.0.0/","@patternfly/pfe-core":"https://ga.jspm.io/npm:@patternfly/pfe-core@2.0.0/core.js","@patternfly/pfe-core/":"https://ga.jspm.io/npm:@patternfly/pfe-core@2.0.0/","@rhds/elements/rh-accordion/rh-accordion.js":"https://ga.jspm.io/npm:@rhds/elements@1.0.0-beta.34/elements/rh-accordion/rh-accordion.js","lit-element/lit-element.js":"https://ga.jspm.io/npm:lit-element@3.2.2/lit-element.js","lit-html":"https://ga.jspm.io/npm:lit-html@2.6.1/lit-html.js","lit-html/":"https://ga.jspm.io/npm:lit-html@2.6.1/","lit/":"https://ga.jspm.io/npm:lit@2.6.1/"}}}</script>
    <script type="module">
    import 'element-internals-polyfill';
    import { PfIcon } from '@patternfly/elements/pf-icon/pf-icon.js';
    import '@rhds/elements/rh-alert/rh-alert.js';
    import '@rhds/elements/rh-pagination/rh-pagination.js';
    import '@rhds/elements/rh-footer/rh-footer.js';
    import '@rhds/elements/rh-navigation-secondary/rh-navigation-secondary.js';
    import '@rhds/elements/rh-stat/rh-stat.js';
    import '@rhds/elements/rh-tag/rh-tag.js';
    import '@rhds/elements/rh-cta/rh-cta.js';
    // Workaround for bundled pf-icon: make icon imports absolute, instead of relative to the bundle
    const iconBase = '/assets/packages/@patternfly/elements/pf-icon/icons';
    PfIcon.getIconUrl = (set, icon) =>
      new URL(`${iconBase}/${set}/${icon}.js`, import.meta.url);
    </script>
  </head>
  <body>
    <header>
      <div id="main-header">
        <a href="/">
          <img src="https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg" alt="Red Hat Israel"/>
        </a>
      </div>
      <rh-navigation-secondary role="navigation">
        <a href="/" slot="logo" id="logo-id">
          רד הט ישראל
        </a>
        <ul slot="nav" aria-labelledby="logo-id">
          <li class=""><a href="/">בית</a></li>
          <li class=""><a href="/about/">אודותינו</a></li>
          <li class=""><a href="/posts/">פוסטים</a></li>
          <li class=""><a href="/publicity/1/">כותבים עלינו</a></li>
          <li class=""><a href="/community/">מעורבות בקהילה</a></li>
          <li><a href="https://talkingopen.podbean.com/">הסכת - מדברים פתוח</a></li>
        </ul>
        <rh-cta slot="cta">
          <a href="/#stats">להתחיל</a>
        </rh-cta>
      </rh-navigation-secondary>
    </header>

    <main
      class="tmpl-post"
      lang="en"
      dir="ltr">
      <header>
  <h1>Dependency Injection in Java is easy - Part 2 - Leveraging with Google Guice</h1>
  
  <div itemscope itemtype="https://schema.org/Person">
    <span itemprop="name">Tomer Figenblat</span>
    
    - <span itemprop="jobTitle">Senior Software Engineer</span>
    
  </div>
  

  <time datetime="2020-08-10">10 אוג׳ 2020</time>

</header>

<aside>
  <h2>תגיות</h2>
  <ul id="post-tags">
    <li><rh-tag><a href="/tags/java/" class="post-tag">java</a></rh-tag></li>
    <li><rh-tag><a href="/tags/programming/" class="post-tag">programming</a></rh-tag></li>
    <li><rh-tag><a href="/tags/tutorial/" class="post-tag">tutorial</a></rh-tag></li>
    <li><rh-tag><a href="/tags/code/" class="post-tag">code</a></rh-tag></li>
  </ul>
  <ul>
    <li>הבא: <a href="/posts/2020-08-14-dependency-injection-in-java-is-easy-part-3/">Dependency Injection in Java is easy - Part 3 - Leveraging with Spring Context</a></li>
    <li>הקודם: <a href="/posts/2020-08-08-dependency-injection-in-java-is-easy-part-1/">Dependency Injection in Java is easy - Part 1 - Merely a design pattern</a></li>
  </ul>
</aside>

<div id="post-body">
  
  <img id="cover-image" alt="an image of some js code" src="https://source.unsplash.com/ieic5Tq8YMk/640x426">
  
  <p>This post is part of a multiple parts tutorial,</br>
This part, as the heading suggests will focus on leveraging <em>Dependency Injection</em> with <a href="https://github.com/google/guice/wiki">Google Guice</a>.</p>
<p>It's advised to start with <a href="../2020-08-08-dependency-injection-in-java-is-easy-part-1.md">Part 1 - Merely a design pattern</a>, to have a sufficient understanding of <em>the dependency injection design pattern</em> required for this part of the tutorial.</p>
<p>But, in you wanna start here instead, I'll recap in a sentence:
<em><a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection</a> is merely a design pattern, a technique, for achieving <a href="https://en.wikipedia.org/wiki/Inversion_of_control">Inversion of Control</a> by writing loosely-coupled code.</em></p>
<p>That's it, you're all caught up.</br>
😁</p>
<p>The next part of this tutorial is quite similar to this one using a different <em>di framework</em>: <a href="../2020-08-14-dependency-injection-in-java-is-easy-part-3.md">Part 3 - Leveraging with Spring Context</a>. You can opt to read it instead of this one, in case you prefer <em>Spring</em>.</p>
<p>If you're still here, let's dive in...</p>
<p>So...</br>
You're probably asking yourselves, what is there to leverage in a base code that follows the <a href="../2020-08-08-dependency-injection-in-java-is-easy-part-1.md">dependency injection design pattern</a> ❔</p>
<p>The answer is simple, <strong>Everything</strong>... ❕</br></p>
<p>I promise you, by the time you'll get through this post, you'll understand the benefits and the necessity of incorporating a <em>di framework</em> in your app.</p>
<p>First, let's touch base about how does <em>dependency injection frameworks</em> work...</br>
It's pretty straight forward, the <em>framework</em> creates dependencies for you!</p>
<p>On one end, you give the <em>framework</em> specific instructions on how to create your dependencies,</br>
on the other end, your objects can either declare the dependencies they need or ask the <em>framework</em> directly for them.</br>
Either way, the framework will comply and return the dependencies as you instructed it.</p>
<p>That's <em>di frameworks</em> in a nutshell, every DI framework, and I mean <strong>Every DI Framework</strong>, I came across, basically works the same.</p>
<p>Sure, there may be different features, different component names, different default behaviors, and most probably different implementation under the hood.</p>
<p>But, to us, <em>the users of those frameworks</em>, there are so many similarities, that I can safely say, If you know one well enough, catching up to another one, should be a piece of 🍰.</p>
<p>For instance, you can find similarities between:</p>
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-autowired-annotation">Spring's Autowired</a> and <a href="https://github.com/google/guice/wiki/GettingStarted#inject-constructor">Guice's Inject</a>, both mark a dependency for injection.</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-java-bean-annotation">Spring's Bean</a> and <a href="https://github.com/google/guice/wiki/ProvidesMethods">Guice's Provides</a>, both incorporate logic for creating a dependency.</p>
</li>
</ul>
<p>Not a believer yet ❔ Alright, let's throw <code>C#</code> in the mix ❕</p>
<ul>
<li>
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-annotation-config">Spring's Configuration</a>, <a href="https://github.com/google/guice/wiki/GettingStarted#guice-modules">Guice's Modules</a>, and <a href="https://autofaccn.readthedocs.io/en/latest/configuration/modules.html">Autofac's Modules</a>, can be used to configure dependencies.</p>
</li>
<li>
<p><a href="https://github.com/google/guice/wiki/Bindings">Guice's Binding</a> and <a href="https://autofaccn.readthedocs.io/en/latest/register/registration.html">Autofac's Registration</a>, are used to configure dependencies with the framework's DSL.</p>
</li>
</ul>
<p>I can go on...</br>
But I believe my point is made.</br>
😎</p>
<p>Under the hood, the <em>framework</em> builds factories that can provide the dependencies to objects based on multiple criteria, such as type and name.</p>
<p>At the base level, there are three common lifecycle scopes for dependencies living in the <em>di framework context</em>:</p>
<ul>
<li>
<p><em>Eager Singleton</em>: <strong>one instance</strong> of the dependency will be created in the framework's context <strong>immediately upon the framework's instantiation</strong>, the same instance will be used by any objects living in the context.</p>
</li>
<li>
<p><em>Lazy Singleton</em>: <strong>one instance</strong> of the dependency will be created in the framework's context <strong>only after the dependency is declared by an object</strong>, upon its instantiation, the same instance will be used by any objects living in the context.</p>
</li>
<li>
<p><em>Non-Singleton</em>: <strong>an instance</strong> of the dependency will be created <strong>per declaration upon every declaration</strong>, meaning, every object declaring will get his instance of the dependency.</p>
</li>
</ul>
<p>There are more scopes, but these are the most commonly used three.</br>
You'll probably bump into dependencies <em>per-session</em>, <em>per-request</em>, <em>per-dependency</em>, and so on...</br>
Some frameworks offer different scopes than others, as features.</p>
<p>So...</br>
Let's code.</p>
<p>Heads up, the example application is the same as the one in <a href="../2020-08-08-dependency-injection-in-java-is-easy-part-1.md">Part 1 - Merely a design pattern</a> minus the parts before incorporating the <em>dependency injection design pattern</em>.</br>
If you got the app section from <em>Part 1</em>, you can skip to the <a href="#2-incorporating-google-guice">incorporating guice section</a>.</p>
<p>You can check out the code for this part of the tutorial in <a href="https://github.com/TomerFi/dependency-injection-java-part2-tutorial">Github</a>.</p>
<h2 id="1-mail-collector-app" tabindex="-1">1. Mail Collector App <a class="direct-link" href="#1-mail-collector-app" aria-hidden="true">#</a></h2>
<p>Let's build an app that collects mail from both <em>Gmail</em> and <em>Microsoft</em> leveraging the <em>Dependency Injection</em> pattern with <code>Google Guice</code>.</p>
<h3 id="1-1-contracts" tabindex="-1">1.1. Contracts <a class="direct-link" href="#1-1-contracts" aria-hidden="true">#</a></h3>
<p>An <em>Enum</em> called <code>MailSource</code> for categorizing the mail source:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">MailSource</span> <span class="token punctuation">{</span><br>  <span class="token constant">GMAIL</span><span class="token punctuation">,</span><br>  <span class="token constant">MICROSOFT</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>An abstract class <code>Mail</code> for contracting mail objects.</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Mail</span> <span class="token punctuation">{</span><br>  <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">MailSource</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Got mail by %s, from %s, with the subject %s"</span><span class="token punctuation">,</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>An interface for contracting services responsible for collecting mail from suppliers, the <code>MailService</code>.</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span><br>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Mail</span><span class="token punctuation">></span></span> <span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>And last, an interface for contracting an engine responsible for collecting mail from multiple services, the <code>MailEngine</code>.</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MailEngine</span> <span class="token punctuation">{</span><br>  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Mail</span><span class="token punctuation">></span></span> <span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="1-2-implementations" tabindex="-1">1.2. Implementations <a class="direct-link" href="#1-2-implementations" aria-hidden="true">#</a></h3>
<h4 id="1-2-1-mail" tabindex="-1">1.2.1. Mail <a class="direct-link" href="#1-2-1-mail" aria-hidden="true">#</a></h4>
<p>For convinience and immutability, The concrete <code>Mail</code> implementaions were designed with a <em>builder pattern</em>.</br>
The <em>Gmail</em> <code>Mail</code> implementation, <code>GmailImpl</code>:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">GmailImpl</span> <span class="token keyword">extends</span> <span class="token class-name">Mail</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> setFrom<span class="token punctuation">;</span><br>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> setSubject<span class="token punctuation">;</span><br><br>  <span class="token keyword">private</span> <span class="token class-name">GmailImpl</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    setFrom <span class="token operator">=</span> from<span class="token punctuation">;</span><br>    setSubject <span class="token operator">=</span> subject<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> setFrom<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> setSubject<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">MailSource</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token class-name">MailSource</span><span class="token punctuation">.</span><span class="token constant">GMAIL</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">GmailImpl<span class="token punctuation">.</span>Builder</span> <span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GmailImpl<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span><br>    <span class="token keyword">private</span> <span class="token class-name">String</span> prepFrom<span class="token punctuation">;</span><br>    <span class="token keyword">private</span> <span class="token class-name">String</span> prepSubject<span class="token punctuation">;</span><br><br>    <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> setFrom<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      prepFrom <span class="token operator">=</span> setFrom<span class="token punctuation">;</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">subject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> setSubject<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      prepSubject <span class="token operator">=</span> setSubject<span class="token punctuation">;</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token class-name">GmailImpl</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">requireNonNull</span><span class="token punctuation">(</span><span class="token function">emptyToNull</span><span class="token punctuation">(</span>prepFrom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"from cannot be empty or null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">requireNonNull</span><span class="token punctuation">(</span><span class="token function">emptyToNull</span><span class="token punctuation">(</span>prepSubject<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"subject cannot be empty or null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GmailImpl</span><span class="token punctuation">(</span>prepFrom<span class="token punctuation">,</span> prepSubject<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The <em>Micsorosft</em> <code>Mail</code> implementation, <code>MicrosoftImpl</code>:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MicrosoftImpl</span> <span class="token keyword">extends</span> <span class="token class-name">Mail</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> setFrom<span class="token punctuation">;</span><br>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> setSubject<span class="token punctuation">;</span><br><br>  <span class="token keyword">private</span> <span class="token class-name">MicrosoftImpl</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    setFrom <span class="token operator">=</span> from<span class="token punctuation">;</span><br>    setSubject <span class="token operator">=</span> subject<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> setFrom<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> setSubject<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">MailSource</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token class-name">MailSource</span><span class="token punctuation">.</span><span class="token constant">MICROSOFT</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MicrosoftImpl<span class="token punctuation">.</span>Builder</span> <span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MicrosoftImpl<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token punctuation">{</span><br>    <span class="token keyword">private</span> <span class="token class-name">String</span> prepFrom<span class="token punctuation">;</span><br>    <span class="token keyword">private</span> <span class="token class-name">String</span> prepSubject<span class="token punctuation">;</span><br><br>    <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> setFrom<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      prepFrom <span class="token operator">=</span> setFrom<span class="token punctuation">;</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token class-name">Builder</span> <span class="token function">subject</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> setSubject<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      prepSubject <span class="token operator">=</span> setSubject<span class="token punctuation">;</span><br>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token class-name">MicrosoftImpl</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">requireNonNull</span><span class="token punctuation">(</span><span class="token function">emptyToNull</span><span class="token punctuation">(</span>prepFrom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"from cannot be empty or null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token function">requireNonNull</span><span class="token punctuation">(</span><span class="token function">emptyToNull</span><span class="token punctuation">(</span>prepSubject<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"subject cannot be empty or null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MicrosoftImpl</span><span class="token punctuation">(</span>prepFrom<span class="token punctuation">,</span> prepSubject<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="1-2-2-mail-services" tabindex="-1">1.2.2. Mail Services <a class="direct-link" href="#1-2-2-mail-services" aria-hidden="true">#</a></h4>
<p>The <em>Gmail</em> <code>MailService</code> implementation:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">GmailService</span> <span class="token keyword">implements</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Mail</span><span class="token punctuation">></span></span> <span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// this is where the actual Gmail api access goes.</span><br>    <span class="token comment">// we'll fake a couple of mails instead.</span><br>    <span class="token keyword">var</span> firstFakeMail <span class="token operator">=</span><br>        <span class="token class-name">GmailImpl</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"a.cool.friend@gmail.com"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span><span class="token string">"wanna get together and write some code?"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> secondFakeMail <span class="token operator">=</span><br>        <span class="token class-name">GmailImpl</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"an.annoying.salesman@some.company.com"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span><span class="token string">"wanna buy some stuff?"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>firstFakeMail<span class="token punctuation">,</span> secondFakeMail<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The <em>Microsoft</em> <code>MailService</code> implementation:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MicrosoftService</span> <span class="token keyword">implements</span> <span class="token class-name">MailService</span> <span class="token punctuation">{</span><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Mail</span><span class="token punctuation">></span></span> <span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// this is where the actual Microsoft api access goes.</span><br>    <span class="token comment">// we'll fake a couple of mails instead.</span><br>    <span class="token keyword">var</span> firstFakeMail <span class="token operator">=</span><br>        <span class="token class-name">MicrosoftImpl</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"my.boss@work.info"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span><span class="token string">"stop writing tutorials and get back to work!"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> secondFakeMail <span class="token operator">=</span><br>        <span class="token class-name">MicrosoftImpl</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"next.door.neighbor@kibutz.org"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span><span class="token string">"do you have philips screwdriver?"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">return</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>firstFakeMail<span class="token punctuation">,</span> secondFakeMail<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="1-2-3-mail-engine" tabindex="-1">1.2.3. Mail Engine <a class="direct-link" href="#1-2-3-mail-engine" aria-hidden="true">#</a></h4>
<p>The concrete implementation of <code>MailEngine</code> is <code>RobustMailEngine</code>, it collects the mail from the different services:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RobustMailEngine</span> <span class="token keyword">implements</span> <span class="token class-name">MailEngine</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MailService</span><span class="token punctuation">></span></span> mailServices<span class="token punctuation">;</span><br><br>  <span class="token keyword">public</span> <span class="token class-name">RobustMailEngine</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MailService</span><span class="token punctuation">></span></span> setMailSerices<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    mailServices <span class="token operator">=</span> setMailSerices<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Mail</span><span class="token punctuation">></span></span> <span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> mailServices<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">MailService</span><span class="token operator">::</span><span class="token function">getMail</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="1-3-the-main-app" tabindex="-1">1.3. The Main App <a class="direct-link" href="#1-3-the-main-app" aria-hidden="true">#</a></h3>
<p>This is the app itself, the <code>MailCollectorApp</code>:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MailCollectorApp</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token class-name">MailEngine</span> engine<span class="token punctuation">;</span><br><br>  <span class="token keyword">public</span> <span class="token class-name">MailCollectorApp</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">MailEngine</span> setEngine<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    engine <span class="token operator">=</span> setEngine<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token string">"No mail found."</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>engine<span class="token punctuation">.</span><span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      ret <span class="token operator">=</span> <span class="token class-name">Joiner</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> gmailService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GmailService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> microsoftService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MicrosoftService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RobustMailEngine</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>gmailService<span class="token punctuation">,</span> microsoftService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MailCollectorApp</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Executing the <em>main method</em> will print:</p>
<pre class="language-text"><code class="language-text">Got mail by GMAIL, from a.cool.friend@gmail.com, with the subject wanna get together and write some code?<br>Got mail by GMAIL, from an.annoying.salesman@some.company.com, with the subject wanna buy some stuff?<br>Got mail by MICROSOFT, from my.boss@work.info, with the subject stop writing tutorials and get back to work!<br>Got mail by MICROSOFT, from next.door.neighbor@kibutz.org, with the subject do you have a star screwdriver?</code></pre>
<p>As you may have noticed, this application designed with the <em>dependency injection design pattern</em> in mind.</br>
The dependencies are currently controlled by the <code>main</code> method, so it should be easy to incorporate <a href="https://github.com/google/guice/wiki">Google Guice</a>.</p>
<h2 id="2-incorporating-google-guice" tabindex="-1">2. Incorporating Google Guice <a class="direct-link" href="#2-incorporating-google-guice" aria-hidden="true">#</a></h2>
<h3 id="2-1-include-maven-dependency" tabindex="-1">2.1. Include maven dependency <a class="direct-link" href="#2-1-include-maven-dependency" aria-hidden="true">#</a></h3>
<p>First off, add this to your <em>pom.xml</em> in the <em>dependencies</em> section:</br>
Please note the version, this version was the latest at the time this tutorial was written.</p>
<pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.google.inject<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>guice<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
<h3 id="2-2-mark-inject" tabindex="-1">2.2. Mark inject <a class="direct-link" href="#2-2-mark-inject" aria-hidden="true">#</a></h3>
<p>We need to tell <em>Guice</em> about the dependencies we want to be injected.</br>
Let's do this for the concrete engine class:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RobustMailEngine</span> <span class="token keyword">implements</span> <span class="token class-name">MailEngine</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MailService</span><span class="token punctuation">></span></span> mailServices<span class="token punctuation">;</span><br><br>  <span class="token annotation punctuation">@Inject</span><br>  <span class="token keyword">public</span> <span class="token class-name">RobustMailEngine</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MailService</span><span class="token punctuation">></span></span> setMailSerices<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    mailServices <span class="token operator">=</span> setMailSerices<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Mail</span><span class="token punctuation">></span></span> <span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> mailServices<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">MailService</span><span class="token operator">::</span><span class="token function">getMail</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>And for the app class:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MailCollectorApp</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token class-name">MailEngine</span> engine<span class="token punctuation">;</span><br><br>  <span class="token annotation punctuation">@Inject</span><br>  <span class="token keyword">public</span> <span class="token class-name">MailCollectorApp</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">MailEngine</span> setEngine<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    engine <span class="token operator">=</span> setEngine<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token string">"No mail found."</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>engine<span class="token punctuation">.</span><span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      ret <span class="token operator">=</span> <span class="token class-name">Joiner</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">//...</span><br><span class="token punctuation">}</span></code></pre>
<p>All we did by adding <code>@Inject</code> annotation on both classes constructor, is tell <em>Guice</em> we need it to provide the dependencies in those constructors for us.</br>
Now, we need to instruct <em>Guice</em> on how to provide those dependencies.</p>
<h3 id="2-3-provide-depndencies" tabindex="-1">2.3. Provide depndencies <a class="direct-link" href="#2-3-provide-depndencies" aria-hidden="true">#</a></h3>
<p>Let's create a <em>Guice Module</em> for configuring the bindings, there are a couple of ways for achiving that.</br>
For instance, using <a href="https://github.com/google/guice/wiki/ProvidesMethods">Guice's Provides Methods</a>:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">DIModule</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractModule</span> <span class="token punctuation">{</span><br>  <span class="token annotation punctuation">@Provides</span><br>  <span class="token keyword">static</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MailService</span><span class="token punctuation">></span></span> <span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GmailService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MicrosoftService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Provides</span><br>  <span class="token annotation punctuation">@Singleton</span><br>  <span class="token keyword">static</span> <span class="token class-name">MailEngine</span> <span class="token function">getEngine</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MailService</span><span class="token punctuation">></span></span> services<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RobustMailEngine</span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Another option is using <a href="https://google.github.io/guice/api-docs/latest/javadoc/com/google/inject/Binder.html">Guice's bind DSL</a>:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">DIModule</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractModule</span> <span class="token punctuation">{</span><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> listBinder <span class="token operator">=</span> <span class="token function">newSetBinder</span><span class="token punctuation">(</span><span class="token function">binder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MailService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    listBinder<span class="token punctuation">.</span><span class="token function">addBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GmailService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    listBinder<span class="token punctuation">.</span><span class="token function">addBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MicrosoftService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">MailEngine</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token class-name">RobustMailEngine</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token class-name">Scopes</span><span class="token punctuation">.</span><span class="token constant">SINGLETON</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Both options will produce the same dependencies.</br>
From a <a href="https://github.com/google/guice/wiki/Scopes">Scopes</a> point-of-view...</br>
<em>Guice</em>'s default scope is <em>Non-Singleton</em>,</br>
meaning the <em>Set</em> of <em>GmailService</em> and <em>MicrosoftService</em> will be created as new instances for every object who needs them.</br></p>
<p>The <em>RobustMailEngine</em> on the other end is bound as a <em>Singelton</em>.</br>
Based on <a href="https://github.com/google/guice/wiki/Scopes#eager-singletons">Guice's docs</a>, that means that in <em>Production stage</em> it will be an <em>Eager Singleton</em>, and in <em>Development stage</em> it will be a <em>Lazy Singleton</em>.</br>
Either way, it's going to be a <em>Singleton</em>, meaning our app will have only one instance of <em>RobustMailEngine</em>.</br></p>
<p>The default stage for <em>Guice</em> is <em>Development stage</em>, so we can expect a <em>Lazy Singleton</em>.</p>
<blockquote>
<p>Please note, <em>RobustMailEngine</em> is a dependency, it will be injected to whoever needs it, but as we configured earlier with <em>@Inject</em>, it also needs dependencies for itself (the <em>Set</em> of <em>MailService</em>).</br>
<em>Guice</em> will catch that and inject the set of mail services while instantiating the engine.</p>
</blockquote>
<h3 id="2-4-update-the-app-to-use-guice" tabindex="-1">2.4 Update the app to use Guice <a class="direct-link" href="#2-4-update-the-app-to-use-guice" aria-hidden="true">#</a></h3>
<p>Let's get back to the to our app and update it to work with <em>Guice</em>:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MailCollectorApp</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token class-name">MailEngine</span> engine<span class="token punctuation">;</span><br><br>  <span class="token annotation punctuation">@Inject</span><br>  <span class="token keyword">public</span> <span class="token class-name">MailCollectorApp</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">MailEngine</span> setEngine<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    engine <span class="token operator">=</span> setEngine<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token string">"No mail found."</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>engine<span class="token punctuation">.</span><span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      ret <span class="token operator">=</span> <span class="token class-name">Joiner</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">getAllMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> injector <span class="token operator">=</span> <span class="token class-name">Guice</span><span class="token punctuation">.</span><span class="token function">createInjector</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DIModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> app <span class="token operator">=</span> injector<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">MailCollectorApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Let's analyze what's going on here...</p>
<p>Running the <em>main</em> method will create a <em>Guice's injector</em>, which is the context for all dependencies to live in.</br>
As we create it with an instance of our <em>DIModule</em> class, the injector's context will have the following dependencies configured in it:</p>
<ul>
<li>A <em>Set</em> of two <em>MailService</em> objects (<em>GmailService</em> and <em>Microsoft Service</em>).</li>
<li>A <em>Singleton</em> instance of <em>MailEngine</em> (<em>RobustMailEngine</em>).</li>
</ul>
<p>As stated, in <em>Development stage</em> the <em>MainEngine</em> is a <em>Lazy Singleton</em>, plus, we configured the <em>Set</em> of <em>MailService</em> as <em>Non-Singleton</em>. That means that at this point, there's nothing instantiated in the injector context. All it has is instructions on how to instantiate.</p>
<p>The next step, asking the injector for an instance of <em>MailCollectorApp</em> will accomplish the following:</p>
<ul>
<li>
<p><em>Guice</em> will pick up the constructor in <em>MailCollectorApp</em>, as it's the only constructor.</p>
</li>
<li>
<p>As the constructor is marked with <em>@Inject</em>, <em>Guice</em> will look in its context for a dependency of type <em>MailEngine</em>.</p>
</li>
<li>
<p>It will find the <em>RobustMailEngine</em> configured, which is a <em>Lazy Singleton</em>.</p>
</li>
<li>
<p>While trying to instantiate it, it will pick up its constructor which is also marked with <em>@Inject</em>.</p>
</li>
<li>
<p><em>Guice</em> will look for a suitable dependency with the type <em>Set</em> of <em>MailService</em>.</p>
</li>
<li>
<p>It will find the <em>Set</em> of <em>GoogleService</em> and <em>MicrosoftService</em>, which is a <em>Non-Singleton</em>.</p>
</li>
</ul>
<p>After preparing the <em>dependency graph</em>, <em>Guice</em> will:</p>
<ul>
<li>
<p>Create the set after instantiating both <em>GmailService</em> and <em>MicrosoftService</em>.</p>
</li>
<li>
<p>Instantiate the <em>RobustMailEngine</em> injecting the <em>Set</em>.</p>
</li>
<li>
<p>Instantiate the <em>MailCollectorApp</em> injecting the <em>RobustMailEngine</em>.</p>
</li>
</ul>
<p>We then get our instance <em>MailCollectorApp</em> with everything we need in it, from which we invoke getMail to get all of our mail.</p>
<p>That's it, <em>Guice</em> in a nutshell.</br>
😆</p>
<p>Now, Let's test the code...</p>
<h2 id="3-unit-tests" tabindex="-1">3. Unit Tests <a class="direct-link" href="#3-unit-tests" aria-hidden="true">#</a></h2>
<p>I'm gonna start by saying, in regards to unit tests, if possible, always prefer <strong>not to use</strong> <em>di frameworks</em> in unit tests.</p>
<p>Unit tests are about testing small parts, units, of your application. You don't need the overhead of creating the <em>di context</em>, it will probably serve no purpose for you. You would probably be better off just instantiating the subject under test manually.</p>
<p>On the other end, if you talking about integration, or acceptance tests, or any other situation when you might need to test your application end-to-end, well, in that case, a good <em>di framework</em> could be your best friend.</p>
<p>That being said, for demonstration purposes only, let's move on to unit tests <strong>with</strong> <em>di framework</em>.</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MailCollectorAppTest</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractModule</span> <span class="token punctuation">{</span><br>  <span class="token keyword">private</span> <span class="token class-name">MailService</span> gmailServiceMock<span class="token punctuation">;</span><br>  <span class="token keyword">private</span> <span class="token class-name">MailService</span> microsoftServiceMock<span class="token punctuation">;</span><br>  <span class="token keyword">private</span> <span class="token class-name">MailService</span> thirdServiceMock<span class="token punctuation">;</span><br><br>  <span class="token keyword">private</span> <span class="token class-name">MailCollectorApp</span> sut<span class="token punctuation">;</span><br><br>  <span class="token keyword">private</span> <span class="token class-name">Faker</span> faker<span class="token punctuation">;</span><br><br>  <span class="token annotation punctuation">@Override</span><br>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> listBinder <span class="token operator">=</span> <span class="token function">newSetBinder</span><span class="token punctuation">(</span><span class="token function">binder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MailService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    listBinder<span class="token punctuation">.</span><span class="token function">addBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstance</span><span class="token punctuation">(</span>gmailServiceMock<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    listBinder<span class="token punctuation">.</span><span class="token function">addBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstance</span><span class="token punctuation">(</span>microsoftServiceMock<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    listBinder<span class="token punctuation">.</span><span class="token function">addBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstance</span><span class="token punctuation">(</span>thirdServiceMock<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token class-name">MailEngine</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token class-name">RobustMailEngine</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token class-name">Scopes</span><span class="token punctuation">.</span><span class="token constant">SINGLETON</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@BeforeEach</span><br>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    faker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Faker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    gmailServiceMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MailService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    microsoftServiceMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MailService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    thirdServiceMock <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">MailService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">var</span> injector <span class="token operator">=</span> <span class="token class-name">Guice</span><span class="token punctuation">.</span><span class="token function">createInjector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    sut <span class="token operator">=</span> injector<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">MailCollectorApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Test</span><br>  <span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><br>      <span class="token string">"make the services mocks return no mail and validate the return string as 'No mail found'"</span><span class="token punctuation">)</span><br>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMail_noMailExists_returnsNoMailFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">given</span><span class="token punctuation">(</span>gmailServiceMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">given</span><span class="token punctuation">(</span>microsoftServiceMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">given</span><span class="token punctuation">(</span>thirdServiceMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">then</span><span class="token punctuation">(</span>sut<span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"No mail found."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token annotation punctuation">@Test</span><br>  <span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><br>      <span class="token string">"make the services return legitimate mail and validate the return string as expected"</span><span class="token punctuation">)</span><br>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getMail_foundMail_returnsExpectedString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> mail1 <span class="token operator">=</span><br>        <span class="token class-name">GmailImpl</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>faker<span class="token punctuation">.</span><span class="token function">internet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emailAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span>faker<span class="token punctuation">.</span><span class="token function">lorem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> mail2 <span class="token operator">=</span><br>        <span class="token class-name">MicrosoftImpl</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>faker<span class="token punctuation">.</span><span class="token function">internet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emailAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span>faker<span class="token punctuation">.</span><span class="token function">lorem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">var</span> mail3 <span class="token operator">=</span><br>        <span class="token class-name">MicrosoftImpl</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>faker<span class="token punctuation">.</span><span class="token function">internet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emailAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span>faker<span class="token punctuation">.</span><span class="token function">lorem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>mail1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">given</span><span class="token punctuation">(</span>gmailServiceMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>mail2<span class="token punctuation">,</span> mail3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">given</span><span class="token punctuation">(</span>microsoftServiceMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">given</span><span class="token punctuation">(</span>thirdServiceMock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">then</span><span class="token punctuation">(</span>sut<span class="token punctuation">.</span><span class="token function">getMail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">containsOnly</span><span class="token punctuation">(</span>mail1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mail2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mail3<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>As you can see, all I did was create the injector with a different module than the one I've used for my app (<em>DIModule</em>).</p>
<p>In this case, I've extended the test class to be a module in itself and inject my mocks instead of the real <em>GmailService</em> and <em>MicrosoftService</em>, I've even added a third service, just for the kick of it. 😁</p>
<p>The <em>RobustMailEngine</em> was not mocked, because there was no real reason to do so, but it could have been easily replaced with a mock or a spy.</p>
<p>My test class behaved exactly like my main app, except for the services being mocks instead of real objects.</p>
<p>You can check out the code for this part of the tutorial in <a href="https://github.com/TomerFi/dependency-injection-java-part2-tutorial">Github</a>.</p>
<p><strong>👋 See you in the next part of this tutorial 👋</strong></p>

</div>

    </main>

    <rh-footer>
      <a slot="logo" href="/">
        <img src="https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg" alt="Red Hat Israel logo" loading="lazy"/> 
      </a>
      <rh-footer-social-link slot="social-links">
        <a href="https://www.linkedin.com/company/red-hat">
          <pf-icon icon="linkedin" set="fab">LinkedIn</pf-icon>
        </a>
      </rh-footer-social-link>
      <rh-footer-social-link slot="social-links">
        <a href="https://www.youtube.com/user/RedHatVideos">
          <pf-icon icon="youtube" set="fab">Youtube</pf-icon>
        </a>
      </rh-footer-social-link>
      <rh-footer-social-link slot="social-links">
        <a href="https://www.facebook.com/redhatinc">
          <pf-icon icon="facebook" set="fab">Facebook</pf-icon>
        </a>
      </rh-footer-social-link>
      <rh-footer-social-link slot="social-links">
        <a href="https://twitter.com/RedHat">
          <pf-icon icon="twitter" set="fab">Twitter</pf-icon>
        </a>
      </rh-footer-social-link>
      <rh-footer-social-link slot="social-links">
        <a href="https://github.com/redhat-israel">
          <pf-icon icon="github" set="fab">GitHub</pf-icon>
        </a>
      </rh-footer-social-link>
      <h3 slot="links">המוצרים שלנו</h3>
      <ul slot="links">
        <li><a href="https://www.redhat.com/en/technologies/management/ansible">Red Hat Ansible Automation Platform</a></li>
        <li><a href="https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux">Red Hat Enterprise Linux</a></li>
        <li><a href="https://www.redhat.com/en/technologies/cloud-computing/openshift">Red Hat OpenShift</a></li>
        <li><a href="https://www.redhat.com/en/technologies/cloud-computing/openshift-data-foundation">Red Hat OpenShift Data Foundation</a></li>
        <li><a href="https://www.redhat.com/en/technologies/linux-platforms/openstack-platform">Red Hat OpenStack Platform</a></li>
        <li><a href="https://www.redhat.com/en/technologies/all-products">See all products</a></li>
      </ul>
      <h3 slot="links">צרו קשר</h3>
      <ul slot="links">
        <li><a href="https://www.redhat.com/en/contact">כתבו לנו</a></li>
        <li><a href="https://www.redhat.com/en/about/feedback">שלחו לנו פידבק</a></li>
        <li><a href="https://www.redhat.com/en/about/social">עקבו אחרינו ברשתות החברתיות</a></li>
      </ul>
      <rh-footer-block slot="main-secondary">
        <h3 slot="header">רד האט</h3>
        <p>רד האט היא החברה המובילה בעולם לפתרונות תוכנה מבוססי קוד פתוח לארגוני Enterprise.
רד האט מבוססת על כוחה של קהילת הקוד הפתוח בפיתוח ואספקת טכנולוגיות Linux, Cloud, Container, ו-Kubernetes.
אנחנו מסייעים ללקוחות לשלב בין יישומי IT חדשים וקיימים, לפתח יישומים רב-ענניים
(multi-cloud), לבצע סטנדרטיזציה של מערכת ההפעלה, יחד עם אוטומציה, אבטחה וניהול של סביבות מורכבות.</p>

      </rh-footer-block>
      <rh-global-footer slot="global" class=" no-secondary-links">
        <h3 slot="links-primary" hidden>Red Hat legal and privacy links</h3>
        <ul slot="links-primary">
          <li><a href="https://www.redhat.com/en/about/privacy-policy">הצהרת פרטיות</a></li>
          <li><a href="https://www.redhat.com/en/about/terms-use">תנאי שימוש</a></li>
          <li><a href="https://www.redhat.com/en/about/digital-accessibility">נגישות דיגיטלית</a></li>
        </ul>
      </rh-global-footer>
    </rh-footer>

    <!-- Google tag (gtag.js) -->
    <script async defer src="https://www.googletagmanager.com/gtag/js?id=G-JENJLEJFBY"></script>
    <script async defer>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JENJLEJFBY');
    </script>
    <!-- Current page: /posts/2020-08-10-dependency-injection-in-java-is-easy-part-2/ -->
  </body>
</html>
